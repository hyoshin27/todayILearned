#DDD start!

>3. 애그리거트

트랜잭션 범위

-트랜잭션 범위는 작을수록 좋다. 한 개의 테이블을 수정할때 잠그는 대상이 한개의 테이블의 한 로우지만 여러개의 테이블을 수정하면 대상이 많아지고 성능을 떨어뜨린다.

-동일하게 한 트랜잭션에서 한개의 애그리거트만 수정해야 한다. 한 트랜잭션에서 두개 이상의 애그리거트를 수정하면 트랜잭션 충돌이 발생할 가능성이 많아지기 때문이다.

-만약 부득이하게 한트랜젝션에서 두개 이상의 애그리거트를 수정해야 한다면 직접 수정하지 말고 응용서비스에서 두 애그리거트를 수정하도록 구현해야 한다.

한 트랜젝션에서 한개의 애그리거트를 변경하는 것을 권장하지만 다음의 경우 한 트랜잭션에서 두개의 애그리거트를 변경하는 것을 고려할 수 있다.

- 팀표준 : 팀이나 조직의 표준에 따라 사용자 유스케이스와 관련된 응용서비스의 기능을 한 트랜잭션으로 실행해야 하는 경우가 있다. DB가 다른 경우 글로벌 트랜잭션을 반드시 사용하도록 규칙을 정하는 곳도 있다.

- 기술 제약 : 힌 트랜잭션에서 두개 이상의 애그리거트를 수정하는 대신 도메인 이벤트와 비동기를 사용하는 방식을 사용하는데 기술적으로 이벤트 방식을 도입할 수 없는 경우 한 트랜잭션에서 다수의 애그리거트를 수정해서 일관성을 처리해야 한다.

공개 set 메서드를 지양해야 하는 이유

-중요 도메인이 의미나 의도를 표한하지 못함

-도메인 로직이 도메인 객체가 아닌 응용 영역으로 분산되게 만드는 원인

- 도메인 로직이 한곳에 응집되어 있지 않게 되므로 코드를 유지보수할 때에도 분석하고 수정하는데 더 많은 시간을 들이게 된다.






 
 

