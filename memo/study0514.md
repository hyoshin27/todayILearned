#클린코드

> 12장 창발성

켄트백 제시한 단순한 설계 규칙

-모든 테스트를 실행한다
: 테스트가 가능한 시스템을 만들려고 노력하면 설계 품질이 높아진다. 크기가 작고 목적 하나만 수행하는 클래스가 나온다. 

-중복을 없앤다
:중복은 추가작업, 추가 위험, 불필요한 복잡도를 뜻하기 때문.

-프로그래머 의도를 표현한다
1. 좋은 이름 선택
2. 함수와 클래스 크기 줄이기
3. 표준명칭
4. 단위 테스트 꼼꼼히 작성
5. 노력

-클래스와 메스드 수를 최소로 줄인다.

> 13장 동시성

-동시성이란?

결합을 없애는 전략. 무엇과 언제를 나누는 전략

동시성은 다소 부하를 유발한다.

동시성은 복잡하다.

일반적으로 동시성 버그는 재현하기 어렵다.

동시성을 구현하려면 흔히 근본적인 설계 전략을 재고해야 한다.

-동시성 방어 원칙

단일 책임 원칙 : 독자적인 개발, 변경, 조율 주기가 있고 다른코드에서 겪는 난관과 다르며 훨씬 어렵다. 주변에 있는 다른 코드가 발목 잡지 않게 따로 구현.

-라이브러리 이해

스레드 환경에 안전한 컬렉션 사영

서로 무관한 작업을 수행할 때는 executor 프레임워크 사용

가능하다면 스레드가 차단 되지 않는 방법

-실행 모델 이해

한정된 자원 : 다중 스레드 환경에서 아용하는 자원, 데이터베이스 연결, 길이가 일정한 읽기/쓰기 버퍼 등

상호 배제 : 한번에 한 스레드만 공유자료나 공유 자원을 사용할 수 있는 경우

기아 : 한 스레드나 여러 스레드가 굉장히 오랫동안 자원을 기다림.

데드락 : 여러 스레드가 서로 끝나길 기다림. 각기 필요한 자원을 점유하는 바람에 어느쪽도 진행하지 못함

라이브락 : 락을 거는 단계에서 각 스레드가 서로 방해

-동기화 하는 메서드 사이에 존재하는 의존성을 이해

클라이언트에서 잠금 : 첫번째 메서드 호출하기 전에 서버를 잠금 마지막 메서드 호출할 때까지 잠금을 유지

서버에서 잠금 : 서버를 잠그고 모든 메서드 호출한 후 잠금을 해제하는 메서드 구현. 클라이언트는 이 메서드 호출

연결 서버 : 잠금을 수행하는 중간단계 생성. 서버에서 잠금과 비슷하지만 원래 서버는 변경하지 않음

-동기화하는 부분을 작게 만들어라

java에서 synchronized를 사용하면 락을 설정한다. 
같은 락으로 감싼 코드 영역은 한번에 한 스레드만 실행이 가능하다. 락은 스레드를 지연시키고 부하를 가중시키기 때문에 남발하면 안된다.

-스레드 코드 테스트

1. 말이 안되는 실패는 잠정적인 스레드 문제로 취금
2. 다중 스레드를 고려하지 않은 순차 코드부터 제대로 돌게 하자
3. 다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 구현
4. 다중스레드를 쓰는 코드 부분을 상황에 맞춰 조정할 수 있게 작성하라
5. 프로세서 수보다 많은 스레드를 돌려봐라
6. 코드에 보조코드를 넣어 돌려라 강제로 실패를 일으켜봐라




 

